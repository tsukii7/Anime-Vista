> ðŸŒ View in Chinese: [ç®€ä½“ä¸­æ–‡](./README.zh-CN.md)

# ðŸ“¦ Redux State Structure Documentation

## 1. Introduction to Redux and Differences from useState

Redux is a predictable state container for JavaScript applications, often used in medium to large React projects to
centrally manage global state. Compared to React's built-in `useState`, Redux is more suitable for scenarios where state
is shared across multiple components or complex business logic needs to be managed.

- `useState` is suitable for local component state with simple logic and limited scope.
- Redux uses a global store to manage all states, allowing components to interact with state via `useSelector` and
  `useDispatch`.

Core concepts of Redux:

- Store: A centralized place to store application state
- Action: Plain objects that describe state changes
- Reducer: Functions that handle actions and return new state
- Middleware (e.g., Redux Thunk): Used for handling asynchronous logic

## 2. Redux Usage and Features in This Project

In this project, Redux is primarily used to manage the state of multiple modules (slices), each representing an
independent business domain with centralized state logic.

Key technologies used:

- Redux Toolkit: Simplifies Redux usage, includes tools like `createSlice` and `configureStore`.
- Redux Thunk: Supports asynchronous requests, such as calling backend APIs and updating state.

The state is modularized via multiple slices in the `src/models` directory, each collaborating to maintain the overall
application state.

Here is an example of a concise and well-structured slice file:

```js
import {createSlice} from '@reduxjs/toolkit';

const initialState = {
    user: null,
};

const loginSlice = createSlice({
    name: 'login',
    initialState,
    reducers: {
        loginWithEmail: (state, action) => {
            state.user = action.payload;
        },
    },
});

export const {loginWithEmail} = loginSlice.actions;
export default loginSlice.reducer;
```

Each slice contains one or more reducers, which are core parts of Redux. A reducer is a pure function that defines how
the state should change based on an action. In Redux Toolkit, reducers are automatically generated by `createSlice`.
Each reducer corresponds to a specific logic for changing the state, such as logging in, logging out, or loading
success.

Components do not directly modify the state but trigger actions to invoke reducers, which then determine how to update
the state:

- `useSelector`: Used to read state from the Redux store. For example, retrieving the current user:

  ```js
  const user = useSelector((state) => state.login.user);
  ```

  This automatically subscribes to state changes and ensures the component updates when the relevant state changes.

- `useDispatch`: Used to dispatch Redux actions, including synchronous and asynchronous (thunk) operations. For
  example, performing a login:

  ```js
  const dispatch = useDispatch();
  dispatch(loginWithEmail({ email: 'test@example.com', password: '123456' }));
  ```

## 3. Structure and Functionality of `src/models` Directory

### 3.1 Directory Structure

Brief overview of the `src/models/` directory:

|                     Directory                     | Corresponding Page                               |
|:-------------------------------------------------:|--------------------------------------------------|
| [authentication](../../src/models/authentication) | Login / Registration                             |
|        [current](../../src/models/current)        | Current                                          |
|        [details](../../src/models/details)        | Details                                          |
|      [developer](../../src/models/developer)      | About (now fetches from Firebase; file is empty) |
|           [home](../../src/models/home)           | Home                                             |
|             [me](../../src/models/me)             | Me                                               |
|           [rank](../../src/models/rank)           | Rank                                             |
|         [search](../../src/models/search)         | Search                                           |

### 3.2 Functionality Description

Summary of each file in `src/models`:

- [loginSlice.js](../../src/models/authentication/loginSlice.js)
    - Handles user authentication state and logic.
    - Features:
        - Register, login (email and Google), password reset, logout.
        - Uses Firebase for authentication and user info updates.
        - Manages login state, error messages, and loading state.
    - State:
        - `error`: error messages from auth process
        - `isLoading`: indicates if an operation is in progress
        - user info stored upon successful login (UID, username, avatar, etc.)

- [listSlice.js](../../src/models/current/listSlice.js)
    - Manages the anime list of the current season and pagination.
    - Features:
        - Fetch paginated anime list of the current season.
        - Fetch total count for pagination.
        - Support page switching.
    - State:
        - `seasonAnime`: anime list of the current season
        - `currentPage`, `totalPages`: pagination info
        - `status`, `error`: loading and error state

- [timelineSlice.js](../../src/models/current/timelineSlice.js)
    - Manages the anime timeline grouped by air date.
    - Features:
        - Fetch current season anime and their schedules.
        - Group and sort anime by date.
        - Supports pagination.
    - State:
        - `seasonAnime`, `groupedAnime`, `currentPage`, `totalPages`, `status`, `error`

- [detailsSlice.js](../../src/models/details/detailsSlice.js)
    - Manages the state and logic of anime detail page.
    - Features:
        - Fetch detailed info by anime ID (title, cover, score, characters, staff, etc.)
    - State:
        - `anime`, `status`, `error`

- [popularityListSlice.js](../../src/models/home/popularityListSlice.js)
    - Manages popular anime list and pagination.
    - Features:
        - Fetch trending anime list.
        - Supports pagination.
    - State:
        - `list`, `currentPage`, `totalPages`, `status`, `error`

- [meSlice.js](../../src/models/me/meSlice.js)
    - Manages user's personal center state (favorites and activity).
    - Features:
        - Supports pagination for favorites and activity records.
        - Provides async operations for batch fetching anime data.
    - State:
        - `favorites`, `activities`: paginated state for user content

- [rankingSlice.js](../../src/models/rank/rankingSlice.js)
    - Manages anime ranking data and logic.
    - Features:
        - Fetch ranking data (sorted by trends, scores, etc.)
        - Support sorting and pagination.
    - State:
        - `list`, `sortType`, `currentPage`, `totalPages`, `status`, `error`

- [fetchTotalSlice.js](../../src/models/search/fetchTotalSlice.js)
    - Auxiliary module to fetch total anime count matching filters.
    - Features:
        - Count matching anime by type, year, season, etc.
        - Used for pagination and search statistics.

- [filterSlice.js](../../src/models/search/filterSlice.js)
    - Manages search and filter criteria state.
    - Features:
        - Update or reset filters (type, year, season, etc.)
        - Handle pagination.
    - State:
        - Current filter conditions (`search`, `genres`, `year`, etc.)
        - `page`, `perPage`: pagination

- [resultSlice.js](../../src/models/search/resultSlice.js)
    - Manages anime search result state and logic.
    - Features:
        - `fetchSearchResults` async operation to fetch results from AniList API.
        - Pagination support (`fetchTotalCount` for total pages).
        - Sync actions for clearing and paging results.
    - State:
        - `results`, `currentPage`, `totalPages`, `total`, `loading`, `error`
    - Dependencies:
        - Relies on `fetchTotalSlice.js` for total count.
